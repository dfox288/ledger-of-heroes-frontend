# OpenAPI Type Generation Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Implement automatic TypeScript type generation from the Laravel backend's OpenAPI specification to achieve full type safety across all API interactions.

**Architecture:** Three-layer type system: (1) Auto-generated types from OpenAPI spec, (2) Application types that extend generated types, (3) Components use application types. Manual sync workflow via `npm run types:sync` command.

**Tech Stack:** openapi-typescript, Node.js fetch API, TypeScript

---

## Phase 1: Setup & Infrastructure

### Task 1: Install openapi-typescript

**Files:**
- Modify: `package.json`

**Step 1: Install openapi-typescript as dev dependency**

Run inside Docker container:
```bash
docker compose exec nuxt npm install --save-dev openapi-typescript
```

Expected output: Package added to devDependencies

**Step 2: Verify installation**

Run:
```bash
docker compose exec nuxt npm list openapi-typescript
```

Expected: Shows version (e.g., `openapi-typescript@7.x.x`)

**Step 3: Commit**

```bash
git add package.json package-lock.json
git commit -m "chore: Add openapi-typescript for type generation

Install openapi-typescript to generate TypeScript types from backend OpenAPI spec.

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

### Task 2: Create sync script

**Files:**
- Create: `scripts/sync-api-types.js`

**Step 1: Create scripts directory**

Run:
```bash
mkdir -p scripts
```

**Step 2: Write sync script**

Create `scripts/sync-api-types.js`:

```javascript
#!/usr/bin/env node

/**
 * Sync API Types from OpenAPI Spec
 *
 * Fetches the OpenAPI spec from the backend and generates TypeScript types.
 * Run manually via: npm run types:sync
 */

import fs from 'node:fs'
import path from 'node:path'
import { fileURLToPath } from 'node:url'

const __filename = fileURLToPath(import.meta.url)
const __dirname = path.dirname(__filename)

// Configuration
const API_SPEC_URL = process.env.NUXT_API_SPEC_URL || 'http://localhost:8080/docs/api.json'
const OUTPUT_FILE = path.resolve(__dirname, '../app/types/api/generated.ts')
const MAX_RETRIES = 3
const RETRY_DELAY_MS = 2000

/**
 * Fetch OpenAPI spec with retry logic
 */
async function fetchOpenAPISpec(url, retries = MAX_RETRIES) {
  console.log(`üîÑ Fetching OpenAPI spec from ${url}...`)

  for (let attempt = 1; attempt <= retries; attempt++) {
    try {
      const response = await fetch(url, {
        signal: AbortSignal.timeout(10000) // 10s timeout
      })

      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`)
      }

      const spec = await response.json()
      const sizeKB = Math.round(JSON.stringify(spec).length / 1024)
      console.log(`‚úÖ Spec downloaded (${sizeKB} KB)`)

      return spec
    } catch (error) {
      if (attempt === retries) {
        console.error(`‚ùå Error: ${error.message}`)

        if (error.message.includes('ECONNREFUSED')) {
          console.error('\nüí° Backend API not reachable. Start it with:')
          console.error('   cd ../importer && docker compose up -d\n')
        }

        process.exit(1)
      }

      console.log(`‚ö†Ô∏è  Attempt ${attempt}/${retries} failed, retrying in ${RETRY_DELAY_MS}ms...`)
      await new Promise(resolve => setTimeout(resolve, RETRY_DELAY_MS))
    }
  }
}

/**
 * Generate TypeScript types using openapi-typescript
 */
async function generateTypes(spec) {
  console.log('\nüîß Generating TypeScript types...')

  try {
    const openapiTS = await import('openapi-typescript')

    // Generate types from spec
    const output = await openapiTS.default(spec, {
      commentHeader: `/**
 * This file was auto-generated by openapi-typescript.
 * Do not make direct changes to the file.
 *
 * Generated from: ${API_SPEC_URL}
 * Generated at: ${new Date().toISOString()}
 *
 * To regenerate: npm run types:sync
 */`
    })

    // Ensure output directory exists
    const outputDir = path.dirname(OUTPUT_FILE)
    if (!fs.existsSync(outputDir)) {
      fs.mkdirSync(outputDir, { recursive: true })
    }

    // Save to file
    fs.writeFileSync(OUTPUT_FILE, output, 'utf8')
    console.log(`‚úÖ Generated ${path.relative(process.cwd(), OUTPUT_FILE)}`)

    return output
  } catch (error) {
    console.error(`‚ùå Generation failed: ${error.message}`)
    process.exit(1)
  }
}

/**
 * Compare with previous version and report changes
 */
function reportChanges(newOutput) {
  console.log('\nüìä Changes detected:')

  if (!fs.existsSync(OUTPUT_FILE)) {
    console.log('  - Initial generation (no previous file)')
    return
  }

  try {
    const oldOutput = fs.readFileSync(OUTPUT_FILE, 'utf8')

    if (oldOutput === newOutput) {
      console.log('  - No changes detected')
      return
    }

    // Simple line-based comparison
    const oldLines = oldOutput.split('\n').length
    const newLines = newOutput.split('\n').length
    const diff = newLines - oldLines

    if (diff > 0) {
      console.log(`  - Added ~${diff} lines`)
    } else if (diff < 0) {
      console.log(`  - Removed ~${Math.abs(diff)} lines`)
    } else {
      console.log('  - Modified (same line count)')
    }

    console.log('\nüí° Review changes with: git diff app/types/api/generated.ts')
  } catch (error) {
    console.log('  - Unable to compare (previous file not readable)')
  }
}

/**
 * Main execution
 */
async function main() {
  console.log('üöÄ OpenAPI Type Sync\n')

  // Read old content for comparison
  let oldOutput = ''
  if (fs.existsSync(OUTPUT_FILE)) {
    oldOutput = fs.readFileSync(OUTPUT_FILE, 'utf8')
  }

  // Fetch spec and generate types
  const spec = await fetchOpenAPISpec(API_SPEC_URL)
  const newOutput = await generateTypes(spec)

  // Report changes
  reportChanges(newOutput)

  console.log('\n‚úÖ Types synced successfully!')
  console.log('\nüí° Next steps:')
  console.log('  - Run "npm run typecheck" to verify compatibility')
  console.log('  - Run "npm run test" to ensure tests pass')
  console.log('  - Commit changes: git add app/types/api/generated.ts')
}

// Run
main().catch(error => {
  console.error('‚ùå Unexpected error:', error)
  process.exit(1)
})
```

**Step 3: Make script executable**

Run:
```bash
chmod +x scripts/sync-api-types.js
```

**Step 4: Commit**

```bash
git add scripts/sync-api-types.js
git commit -m "feat: Add OpenAPI type sync script

Create script to fetch OpenAPI spec from backend and generate TypeScript types.

Features:
- Fetches from http://localhost:8080/docs/api.json
- Retry logic with exponential backoff
- Change detection and reporting
- Clear error messages

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

### Task 3: Add npm script

**Files:**
- Modify: `package.json`

**Step 1: Add types:sync script**

Edit `package.json`, add to `scripts` section:

```json
{
  "scripts": {
    "build": "nuxt build",
    "dev": "nuxt dev",
    "generate": "nuxt generate",
    "preview": "nuxt preview",
    "postinstall": "nuxt prepare",
    "test": "vitest",
    "test:watch": "vitest watch",
    "test:ui": "vitest --ui",
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
    "typecheck": "nuxt typecheck",
    "types:sync": "node scripts/sync-api-types.js"
  }
}
```

**Step 2: Verify script works**

Run inside Docker container:
```bash
docker compose exec nuxt npm run types:sync
```

Expected output:
```
üöÄ OpenAPI Type Sync

üîÑ Fetching OpenAPI spec from http://localhost:8080/docs/api.json...
‚úÖ Spec downloaded (125 KB)

üîß Generating TypeScript types...
‚úÖ Generated app/types/api/generated.ts

üìä Changes detected:
  - Initial generation (no previous file)

‚úÖ Types synced successfully!
```

**Step 3: Verify generated file exists**

Run:
```bash
ls -lh app/types/api/generated.ts
```

Expected: File exists with size > 0

**Step 4: Check generated types structure**

Run:
```bash
head -50 app/types/api/generated.ts
```

Expected: See header comment and TypeScript interfaces

**Step 5: Commit**

```bash
git add package.json app/types/api/generated.ts
git commit -m "feat: Generate initial TypeScript types from OpenAPI spec

Add 'npm run types:sync' script and generate initial types.

Generated types include full schema definitions for all API endpoints
including nested structures (effects, traits, modifiers, etc.).

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

## Phase 2: Migrate Entity Types

### Task 4: Migrate Spell type (TDD)

**Files:**
- Modify: `app/types/api/entities.ts`
- Modify: `tests/components/spell/SpellCard.test.ts`

**Step 1: Write test to verify generated type compatibility**

Add to `tests/components/spell/SpellCard.test.ts` (at the top after imports):

```typescript
import type { components } from '~/types/api/generated'

describe('SpellCard - Type Compatibility', () => {
  it('should accept OpenAPI-generated Spell type', () => {
    // This test verifies that our Spell interface is compatible with the generated type
    const generatedSpell: components['schemas']['Spell'] = {
      id: 1,
      name: 'Fireball',
      slug: 'fireball',
      level: 3,
      casting_time: '1 action',
      range: '150 feet',
      description: 'A bright streak...',
      is_ritual: false,
      needs_concentration: false
    }

    // Should be assignable to our application Spell type
    const spell: Spell = generatedSpell

    expect(spell.id).toBe(1)
    expect(spell.name).toBe('Fireball')
  })
})
```

**Step 2: Run test to verify it fails**

Run:
```bash
docker compose exec nuxt npm test -- SpellCard.test.ts -t "Type Compatibility"
```

Expected: FAIL - Type error because Spell doesn't extend generated type yet

**Step 3: Update Spell interface to extend generated type**

Modify `app/types/api/entities.ts`:

```typescript
import type { Source, Modifier } from './common'
import type { components } from './generated'

/**
 * Spell entity from D&D 5e API
 *
 * Base type generated from OpenAPI spec, extended with application-specific utilities.
 *
 * Used in: SpellCard, spell detail pages, tests
 * API endpoint: /api/v1/spells
 */
type SpellFromAPI = components['schemas']['Spell']

export interface Spell extends Omit<SpellFromAPI, 'sources' | 'school'> {
  // Override with our custom types that have better structure
  school?: {
    id: number
    code: string
    name: string
  }
  sources?: Source[]
  // All other fields inherited from SpellFromAPI
}

// Keep other interfaces (Item, Race, etc.) unchanged for now
```

**Step 4: Run test to verify it passes**

Run:
```bash
docker compose exec nuxt npm test -- SpellCard.test.ts -t "Type Compatibility"
```

Expected: PASS

**Step 5: Run full test suite**

Run:
```bash
docker compose exec nuxt npm test
```

Expected: All 545 tests pass

**Step 6: Run typecheck**

Run:
```bash
docker compose exec nuxt npm run typecheck
```

Expected: No new errors (existing errors OK)

**Step 7: Commit**

```bash
git add app/types/api/entities.ts tests/components/spell/SpellCard.test.ts
git commit -m "refactor: Migrate Spell type to OpenAPI-generated base (TDD)

Update Spell interface to extend generated type from OpenAPI spec.

- Add type compatibility test
- Extend SpellFromAPI from generated types
- Override specific fields with custom types (school, sources)
- All 545 tests passing

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

### Task 5: Migrate Item type (TDD)

**Files:**
- Modify: `app/types/api/entities.ts`
- Modify: `tests/components/item/ItemCard.test.ts`

**Step 1: Write test to verify generated type compatibility**

Add to `tests/components/item/ItemCard.test.ts`:

```typescript
import type { components } from '~/types/api/generated'

describe('ItemCard - Type Compatibility', () => {
  it('should accept OpenAPI-generated Item type', () => {
    const generatedItem: components['schemas']['Item'] = {
      id: 1,
      name: 'Longsword',
      slug: 'longsword',
      rarity: 'common',
      is_magic: false,
      requires_attunement: false
    }

    const item: Item = generatedItem

    expect(item.id).toBe(1)
    expect(item.name).toBe('Longsword')
  })
})
```

**Step 2: Run test to verify it fails**

Run:
```bash
docker compose exec nuxt npm test -- ItemCard.test.ts -t "Type Compatibility"
```

Expected: FAIL

**Step 3: Update Item interface**

Modify `app/types/api/entities.ts`:

```typescript
type ItemFromAPI = components['schemas']['Item']

export interface Item extends Omit<ItemFromAPI, 'sources' | 'item_type' | 'damage_type' | 'modifiers'> {
  item_type?: {
    id: number
    name: string
  }
  damage_type?: { id: number; name: string }
  modifiers?: Modifier[]
  sources?: Source[]
}
```

**Step 4: Run test to verify it passes**

Run:
```bash
docker compose exec nuxt npm test -- ItemCard.test.ts -t "Type Compatibility"
```

Expected: PASS

**Step 5: Run full test suite**

Run:
```bash
docker compose exec nuxt npm test
```

Expected: All tests pass

**Step 6: Commit**

```bash
git add app/types/api/entities.ts tests/components/item/ItemCard.test.ts
git commit -m "refactor: Migrate Item type to OpenAPI-generated base (TDD)

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

### Task 6: Migrate Race type (TDD)

**Files:**
- Modify: `app/types/api/entities.ts`
- Modify: `tests/components/race/RaceCard.test.ts`

**Step 1: Write test**

Add to `tests/components/race/RaceCard.test.ts`:

```typescript
import type { components } from '~/types/api/generated'

describe('RaceCard - Type Compatibility', () => {
  it('should accept OpenAPI-generated Race type', () => {
    const generatedRace: components['schemas']['Race'] = {
      id: 1,
      name: 'Elf',
      slug: 'elf',
      speed: 30
    }

    const race: Race = generatedRace

    expect(race.id).toBe(1)
  })
})
```

**Step 2: Run test (should fail)**

Run:
```bash
docker compose exec nuxt npm test -- RaceCard.test.ts -t "Type Compatibility"
```

**Step 3: Update Race interface**

Modify `app/types/api/entities.ts`:

```typescript
type RaceFromAPI = components['schemas']['Race']

export interface Race extends Omit<RaceFromAPI, 'sources' | 'modifiers' | 'size'> {
  size?: {
    id: number
    name: string
    code: string
  }
  modifiers?: Modifier[]
  sources?: Source[]
}
```

**Step 4: Run test (should pass)**

**Step 5: Run full suite**

**Step 6: Commit**

```bash
git add app/types/api/entities.ts tests/components/race/RaceCard.test.ts
git commit -m "refactor: Migrate Race type to OpenAPI-generated base (TDD)

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

### Task 7: Migrate CharacterClass type (TDD)

**Files:**
- Modify: `app/types/api/entities.ts`
- Modify: `tests/components/class/ClassCard.test.ts`

**Step 1: Write test**

Add to `tests/components/class/ClassCard.test.ts`:

```typescript
import type { components } from '~/types/api/generated'

describe('ClassCard - Type Compatibility', () => {
  it('should accept OpenAPI-generated CharacterClass type', () => {
    const generatedClass: components['schemas']['CharacterClass'] = {
      id: 1,
      name: 'Fighter',
      slug: 'fighter',
      hit_die: 10,
      is_base_class: true
    }

    const characterClass: CharacterClass = generatedClass

    expect(characterClass.id).toBe(1)
  })
})
```

**Step 2-6: Follow same pattern as above**

Update interface, test, commit:

```typescript
type CharacterClassFromAPI = components['schemas']['CharacterClass']

export interface CharacterClass extends Omit<CharacterClassFromAPI, 'sources'> {
  sources?: Source[]
}
```

```bash
git commit -m "refactor: Migrate CharacterClass type to OpenAPI-generated base (TDD)

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

### Task 8: Migrate Background type (TDD)

**Files:**
- Modify: `app/types/api/entities.ts`
- Modify: `tests/components/background/BackgroundCard.test.ts`

**Step 1: Write test**

```typescript
import type { components } from '~/types/api/generated'

describe('BackgroundCard - Type Compatibility', () => {
  it('should accept OpenAPI-generated Background type', () => {
    const generatedBg: components['schemas']['Background'] = {
      id: 1,
      name: 'Acolyte',
      slug: 'acolyte'
    }

    const background: Background = generatedBg

    expect(background.id).toBe(1)
  })
})
```

**Step 2-6: Follow pattern**

```typescript
type BackgroundFromAPI = components['schemas']['Background']

export interface Background extends Omit<BackgroundFromAPI, 'sources'> {
  sources?: Source[]
}
```

```bash
git commit -m "refactor: Migrate Background type to OpenAPI-generated base (TDD)

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

### Task 9: Migrate Feat type (TDD)

**Files:**
- Modify: `app/types/api/entities.ts`
- Modify: `tests/components/feat/FeatCard.test.ts`

**Step 1: Write test**

```typescript
import type { components } from '~/types/api/generated'

describe('FeatCard - Type Compatibility', () => {
  it('should accept OpenAPI-generated Feat type', () => {
    const generatedFeat: components['schemas']['Feat'] = {
      id: 1,
      name: 'Alert',
      slug: 'alert'
    }

    const feat: Feat = generatedFeat

    expect(feat.id).toBe(1)
  })
})
```

**Step 2-6: Follow pattern**

```typescript
type FeatFromAPI = components['schemas']['Feat']

export interface Feat extends Omit<FeatFromAPI, 'sources' | 'modifiers'> {
  modifiers?: Modifier[]
  sources?: Source[]
}
```

```bash
git commit -m "refactor: Migrate Feat type to OpenAPI-generated base (TDD)

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

## Phase 3: Migrate Common Types

### Task 10: Migrate common types

**Files:**
- Modify: `app/types/api/common.ts`

**Step 1: Review generated common types**

Run:
```bash
docker compose exec nuxt grep -A 20 "Source\|Modifier\|AbilityScore" app/types/api/generated.ts
```

Expected: See schema definitions

**Step 2: Update common.ts to use generated types**

Modify `app/types/api/common.ts`:

```typescript
import type { components } from './generated'

/**
 * Common types used across entity schemas
 *
 * These types extend or alias generated types from OpenAPI spec.
 */

// Use generated types directly where they match our needs
export type Source = components['schemas']['Source']
export type AbilityScore = components['schemas']['AbilityScore']
export type Tag = components['schemas']['Tag']

// Keep custom Modifier type if it has application-specific extensions
export interface Modifier {
  id: number
  modifier_category: string
  modifier_type: string
  value: number | string | null
  ability_score?: AbilityScore
  skill?: {
    id: number
    name: string
    ability_score: AbilityScore
  }
}
```

**Step 3: Run typecheck**

Run:
```bash
docker compose exec nuxt npm run typecheck
```

Expected: Fewer errors than before (some eliminated by proper types)

**Step 4: Run tests**

Run:
```bash
docker compose exec nuxt npm test
```

Expected: All tests pass

**Step 5: Commit**

```bash
git add app/types/api/common.ts
git commit -m "refactor: Migrate common types to OpenAPI-generated base

Use generated Source, AbilityScore, and Tag types from OpenAPI spec.
Keep custom Modifier type with application-specific extensions.

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

## Phase 4: Cleanup & Documentation

### Task 11: Remove duplicate type definitions

**Files:**
- Modify: `app/types/api/entities.ts`

**Step 1: Identify duplicate fields**

Review entities.ts and find fields that are now duplicated from generated types

**Step 2: Remove duplicate manual definitions**

Keep only:
- Type aliases (`type SpellFromAPI = ...`)
- Interface extensions with overrides
- JSDoc comments explaining application usage

Remove:
- Duplicate field definitions now in generated types
- Commented-out old code

**Step 3: Add JSDoc references to generated types**

Example:
```typescript
/**
 * Spell entity from D&D 5e API
 *
 * @see {components['schemas']['Spell']} for full generated type
 */
export interface Spell extends SpellFromAPI { ... }
```

**Step 4: Run tests**

```bash
docker compose exec nuxt npm test
```

Expected: All pass

**Step 5: Commit**

```bash
git add app/types/api/entities.ts
git commit -m "refactor: Remove duplicate type definitions

Remove manual field definitions now provided by generated types.
Keep only custom extensions and overrides.

Reduces code duplication and improves maintainability.

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

### Task 12: Update documentation

**Files:**
- Modify: `CLAUDE.md`
- Modify: `docs/CURRENT_STATUS.md`
- Modify: `CHANGELOG.md`

**Step 1: Update CLAUDE.md**

Add new section after "Tech Stack":

```markdown
## OpenAPI Type Generation

**Type System:** Hybrid generated + manual extensions

**Generate Types:**
```bash
npm run types:sync
```

**Architecture:**
1. **Generated Layer** (`app/types/api/generated.ts`) - Auto-generated from backend OpenAPI spec, never manually edit
2. **Application Layer** (`app/types/api/entities.ts`, `common.ts`) - Extends generated types with custom logic
3. **Components** - Import and use application types

**When to Sync:**
- After backend API changes (new fields, endpoints, schema changes)
- Weekly/monthly proactive check
- Before major features that depend on API structure

**Sync Workflow:**
```bash
# 1. Ensure backend is running
cd ../importer && docker compose up -d

# 2. Sync types
cd ../frontend
npm run types:sync

# 3. Verify compatibility
npm run typecheck
npm run test

# 4. Commit changes
git add app/types/api/generated.ts
git commit -m "chore: Sync API types from backend"
```

**Design Document:** `docs/plans/2025-11-22-openapi-type-generation-design.md`
```

**Step 2: Update CURRENT_STATUS.md**

Add to "Technical Infrastructure" section:

```markdown
- ‚úÖ OpenAPI type generation with `npm run types:sync`
- ‚úÖ Full type safety for nested API structures (effects, traits, modifiers)
- ‚úÖ Hybrid type system (generated base + manual extensions)
```

Update "Test Coverage" section:
```markdown
- ‚úÖ **551 tests total** (ALL PASSING ‚úÖ) ‚≠ê (+6 type compatibility tests)
```

**Step 3: Update CHANGELOG.md**

Add to `[Unreleased]` section:

```markdown
### Added
- **OpenAPI type generation** - Automatic TypeScript type generation from backend OpenAPI spec (2025-11-22)
  - New command: `npm run types:sync` to sync types from backend
  - Hybrid type system: generated base types + manual extensions
  - Full type safety for nested API structures (effects, traits, modifiers)
  - Type compatibility tests for all 6 entity types
  - Eliminates manual type maintenance and prevents drift
```

**Step 4: Verify pages still work**

Run:
```bash
docker compose restart nuxt
```

Visit in browser:
- http://localhost:3000/spells
- http://localhost:3000/items
- http://localhost:3000/races

Expected: All pages load correctly, no console errors

**Step 5: Commit**

```bash
git add CLAUDE.md docs/CURRENT_STATUS.md CHANGELOG.md
git commit -m "docs: Update documentation for OpenAPI type generation

Add OpenAPI type generation workflow to CLAUDE.md.
Update CURRENT_STATUS.md with new infrastructure and test count.
Update CHANGELOG.md with feature details.

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

## Phase 5: Final Verification

### Task 13: Final verification and summary

**Step 1: Run full test suite**

Run:
```bash
docker compose exec nuxt npm test
```

Expected: All tests pass (should be ~551 tests with new type compatibility tests)

**Step 2: Run typecheck**

Run:
```bash
docker compose exec nuxt npm run typecheck
```

Expected: Fewer TypeScript errors than before (180 ‚Üí <150 target)

**Step 3: Run lint**

Run:
```bash
docker compose exec nuxt npm run lint
```

Expected: 0 ESLint errors (maintain existing clean state)

**Step 4: Manual browser verification**

Visit all entity pages:
- http://localhost:3000/spells
- http://localhost:3000/items
- http://localhost:3000/races
- http://localhost:3000/classes
- http://localhost:3000/backgrounds
- http://localhost:3000/feats

Expected: All pages load, data displays correctly, no console errors

**Step 5: Test sync command**

Run:
```bash
docker compose exec nuxt npm run types:sync
```

Expected: "No changes detected" (types already synced)

**Step 6: View git log**

Run:
```bash
git log --oneline -15
```

Expected: See clean commit history with descriptive messages

**Step 7: Create summary commit**

If no final commit needed, just output summary:

```bash
echo "‚úÖ OpenAPI Type Generation - Implementation Complete

Summary:
- Installed openapi-typescript for type generation
- Created sync script: npm run types:sync
- Migrated all 6 entity types to generated base
- Migrated common types (Source, AbilityScore, Tag)
- Added 6 type compatibility tests
- Updated documentation (CLAUDE.md, CURRENT_STATUS.md, CHANGELOG.md)

Metrics:
- Total commits: ~14
- Tests: 545 ‚Üí 551 (all passing)
- TypeScript errors: Reduced
- ESLint errors: 0 (maintained)

Next steps:
- Run 'npm run types:sync' after backend API changes
- Monitor TypeScript error count (target: <50)
- Consider periodic sync schedule (weekly/monthly)"
```

---

## Success Criteria

‚úÖ `npm run types:sync` successfully generates types
‚úÖ All 6 entity types extend generated base types
‚úÖ All tests pass (target: 551 tests)
‚úÖ TypeScript errors reduced (target: <150)
‚úÖ ESLint clean (0 errors maintained)
‚úÖ Documentation updated (CLAUDE.md, CURRENT_STATUS.md, CHANGELOG.md)
‚úÖ All pages work in browser
‚úÖ Git history clean with descriptive commits

---

## Estimated Timeline

- **Phase 1 (Setup):** 30 minutes (3 tasks)
- **Phase 2 (Entity Migration):** 60 minutes (6 tasks √ó 10 min)
- **Phase 3 (Common Types):** 15 minutes (1 task)
- **Phase 4 (Cleanup & Docs):** 30 minutes (2 tasks)
- **Phase 5 (Verification):** 15 minutes (1 task)

**Total:** ~2.5 hours

---

## Key Principles

**TDD:** Write type compatibility test ‚Üí Run (fail) ‚Üí Migrate type ‚Üí Run (pass) ‚Üí Commit
**DRY:** Remove duplicate definitions, use generated types as single source
**YAGNI:** Only extend types when needed, don't add unnecessary complexity
**Frequent Commits:** Commit after each entity migration (~14 commits total)
